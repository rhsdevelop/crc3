{% extends 'base.html' %}
{% load bootstrap4 %}

{% block corpo %}
<div class="col-lg-12">
  <a href="/activities/relatorios/list/" ><button class="btn btn-info"><span class="fas fa-backward"></span> Voltar para lista de relat√≥rios</button></a>
</div><br>
<div class="container-fluid">
  <h5>Preencher dados</h5>
  <div>
    <form action="." class="form-horizontal" method="post">
      <div class="row">
        {% csrf_token %}
        <div class="col-lg-6">
          <div class="row">
            <div class="col-lg-12">
              {% bootstrap_field form.publicador %}
            </div>
            <div class="col-lg-12">
              {% bootstrap_field form.tipo %}
            </div>
            <div class="col-lg-12">
              {% bootstrap_field form.mes %}
            </div>
            <div class="col-lg-12">
              {% bootstrap_field form.presente %}
            </div>
            <div class="col-lg-12">
              {% bootstrap_field form.horas %}
            </div>
            <div class="col-lg-12">
              {% bootstrap_field form.estudos %}
            </div>
            <div class="col-lg-12">
              {% bootstrap_field form.observacao %}
            </div>
            <div class="col-lg-12">
              {% bootstrap_field form.atv_local %}
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-12">
        <button class="btn btn-primary" type="submit">Atualizar</button>
      </div>
    </form>
  </div>
</div>
<br>
{% endblock %}
{% block js %}
<script type="text/javascript">
  $(document).ready(function(){
    $('#id_publicador').on('change',function(e){
      if(this.value != ''){
        console.log(this.value);
        $.ajax('?publicador=' + this.value + '&mes=' + document.getElementById("id_mes").value, {
          url:'.',
          type:'GET',
          success: function(data) {
            var obj = JSON.parse(data);
            $('#id_tipo')
              .find('option')
              .remove()
              .end();
            for(var i = 0;i<obj.length;i++){
              $("#id_tipo").append('<option value="'+obj[i][0]+'">'+obj[i][1]+'</option>');
              if(obj[i][0] == 0){
                console.log(obj[i][0])
                $('#id_horas').attr('disabled', 'disabled');
              }else{
                $('#id_horas').removeAttr('disabled', 'disabled');
              }
            }
          }
        });
      };
      if(!this.value){
        $('#id_tipo')
        .find('option')
        .remove()
        .end();
      };
    });
    $('#id_mes').on('change',function(e){
      if(this.value != ''){
        console.log(this.value);
        $.ajax('?publicador=' + document.getElementById("id_publicador").value + '&mes=' + this.value, {
          url:'.',
          type:'GET',
          success: function(data) {
            var obj = JSON.parse(data);
            $('#id_tipo')
              .find('option')
              .remove()
              .end();
            for(var i = 0;i<obj.length;i++){
              $("#id_tipo").append('<option value="'+obj[i][0]+'">'+obj[i][1]+'</option>');
              if(obj[i][0] == 0){
                console.log(obj[i][0])
                $('#id_horas').attr('disabled', 'disabled');
              }else{
                $('#id_horas').removeAttr('disabled', 'disabled');
              }
            }
          }
        });
      };
      if(!this.value){
        $('#id_tipo')
        .find('option')
        .remove()
        .end();
      };
    });
  });
</script>
{% endblock %}
